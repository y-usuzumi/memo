# 并行与并发编程

## 三个问题

1. 原子性问题
1. 可见性问题

   ```java
   // Thread 1
   int i = 0;
   i = 10;

   // Thread 2
   j = i;  // 线程1将i加载到调整缓存，然后赋值为10,却不一定立即写回主存。
           // 此时线程2从主存中读取i，结果为0。
   ```

1. 有序性问题

    ```java
    int i = 0;
    boolean flag = false;

    i = 1;
    flag = true;

    // 由于i和flag互不相干，可能在JVM中发生指令重排序（Dynamic
    // execution / Out-of-order execution）。
    ```

    ```java
    //线程1:
    context = loadContext();   //语句1
    inited = true;             //语句2

    //线程2:
    while(!inited) {
        sleep();
    }
    doSomethingwithconfig(context);

    // 线程1中的指令可能发生重排序，此时在线程2看来，有可能在inited已经置为true
    // 的情况下，loadContext仍然未被调用。
    ```

    Java的`volatile`关键字保证了**可见性**。

##
